{
	"name": "check-partitions",
	"properties": {
		"folder": {
			"name": "sanfrancisco/dedicated/partitioning"
		},
		"content": {
			"query": "SELECT  pnp.partition_number, sum(nps.[row_count]) AS Row_Count\nFROM\n   sys.tables t\nINNER JOIN sys.indexes i\n    ON  t.[object_id] = i.[object_id]\n    AND i.[index_id] <= 1 /* HEAP = 0, CLUSTERED or CLUSTERED_COLUMNSTORE =1 */\nINNER JOIN sys.pdw_table_mappings tm\n    ON t.[object_id] = tm.[object_id]\nINNER JOIN sys.pdw_nodes_tables nt\n    ON tm.[physical_name] = nt.[name]\nINNER JOIN sys.pdw_nodes_partitions pnp \n    ON nt.[object_id]=pnp.[object_id] \n    AND nt.[pdw_node_id]=pnp.[pdw_node_id] \n    AND nt.[distribution_id] = pnp.[distribution_id]\nINNER JOIN sys.dm_pdw_nodes_db_partition_stats nps\n    ON nt.[object_id] = nps.[object_id]\n    AND nt.[pdw_node_id] = nps.[pdw_node_id]\n    AND nt.[distribution_id] = nps.[distribution_id]\n    AND pnp.[partition_id]=nps.[partition_id]\nWHERE t.name='stg_calls_2001_part'\nGROUP BY pnp.partition_number;\n\n\nselect \n\tcase \n\twhen month([Date]) in (1, 2, 3) then '01-gen-mar'\n\twhen month([Date]) in (4, 5, 6, 7) then '02-apr-lug'\n\twhen month([Date]) in (8, 9, 10, 11, 12) then '03-ago-dic'\n\tend as 'Intervallo'\n\t,count(*) as Num\nfrom fire.stg_calls_2001_part\ngroup by\n\tcase \n\twhen month([Date]) in (1, 2, 3) then '01-gen-mar'\n\twhen month([Date]) in (4, 5, 6, 7) then '02-apr-lug'\n\twhen month([Date]) in (8, 9, 10, 11, 12) then '03-ago-dic'\n\tend\norder by Intervallo\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "devDedicatedSQLpool",
				"poolName": "devDedicatedSQLpool"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}