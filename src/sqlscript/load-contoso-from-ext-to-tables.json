{
	"name": "load-contoso-from-ext-to-tables",
	"properties": {
		"folder": {
			"name": "dedicated-sql-pool"
		},
		"content": {
			"query": "-- CREATE SCHEMA [cso]\n-- GO\n\n-- SELECT GETDATE();\n-- GO\n\n-- CREATE TABLE [cso].[DimProduct]            WITH (DISTRIBUTION = HASH([ProductKey]  ) ) AS SELECT * FROM [asb].[DimProduct]             OPTION (LABEL = 'CTAS : Load [cso].[DimProduct]             ');\n-- CREATE TABLE [cso].[FactOnlineSales]       WITH (DISTRIBUTION = HASH([ProductKey]  ) ) AS SELECT * FROM [asb].[FactOnlineSales]        OPTION (LABEL = 'CTAS : Load [cso].[FactOnlineSales]        ');\n\n-- -- To see all requests\n-- SELECT * FROM sys.dm_pdw_exec_requests;\n\n-- -- To see a particular request identified by its label\n-- SELECT * FROM sys.dm_pdw_exec_requests as r\n-- WHERE r.[label] = 'CTAS : Load [cso].[DimProduct]             '\n--       OR r.[label] = 'CTAS : Load [cso].[FactOnlineSales]        '\n-- ;\n\n-- -- To track bytes and files\n-- SELECT\n--     r.command,\n--     s.request_id,\n--     r.status,\n--     count(distinct input_name) as nbr_files,\n--     sum(s.bytes_processed)/1024/1024/1024 as gb_processed\n-- FROM\n--     sys.dm_pdw_exec_requests r\n--     inner join sys.dm_pdw_dms_external_work s\n--         on r.request_id = s.request_id\n-- WHERE\n--     r.[label] = 'CTAS : Load [cso].[DimProduct]             '\n--     OR r.[label] = 'CTAS : Load [cso].[FactOnlineSales]        '\n-- GROUP BY\n--     r.command,\n--     s.request_id,\n--     r.status\n-- ORDER BY\n--     nbr_files desc,\n--     gb_processed desc;\n\n-- SELECT GETDATE();\n-- GO\n\n-- ALTER INDEX ALL ON [cso].[DimProduct]               REBUILD;\n-- ALTER INDEX ALL ON [cso].[FactOnlineSales]          REBUILD;\n\n-- CREATE STATISTICS [stat_cso_DimProduct_AvailableForSaleDate] ON [cso].[DimProduct]([AvailableForSaleDate]);\n-- CREATE STATISTICS [stat_cso_DimProduct_BrandName] ON [cso].[DimProduct]([BrandName]);\n-- CREATE STATISTICS [stat_cso_DimProduct_ClassID] ON [cso].[DimProduct]([ClassID]);\n-- CREATE STATISTICS [stat_cso_DimProduct_ClassName] ON [cso].[DimProduct]([ClassName]);\n-- CREATE STATISTICS [stat_cso_DimProduct_ColorID] ON [cso].[DimProduct]([ColorID]);\n-- CREATE STATISTICS [stat_cso_DimProduct_ColorName] ON [cso].[DimProduct]([ColorName]);\n-- CREATE STATISTICS [stat_cso_DimProduct_ETLLoadID] ON [cso].[DimProduct]([ETLLoadID]);\n-- CREATE STATISTICS [stat_cso_DimProduct_ImageURL] ON [cso].[DimProduct]([ImageURL]);\n-- CREATE STATISTICS [stat_cso_DimProduct_LoadDate] ON [cso].[DimProduct]([LoadDate]);\n-- CREATE STATISTICS [stat_cso_DimProduct_Manufacturer] ON [cso].[DimProduct]([Manufacturer]);\n-- CREATE STATISTICS [stat_cso_DimProduct_ProductDescription] ON [cso].[DimProduct]([ProductDescription]);\n-- CREATE STATISTICS [stat_cso_DimProduct_ProductKey] ON [cso].[DimProduct]([ProductKey]);\n-- CREATE STATISTICS [stat_cso_DimProduct_ProductLabel] ON [cso].[DimProduct]([ProductLabel]);\n-- CREATE STATISTICS [stat_cso_DimProduct_ProductName] ON [cso].[DimProduct]([ProductName]);\n-- CREATE STATISTICS [stat_cso_DimProduct_ProductSubcategoryKey] ON [cso].[DimProduct]([ProductSubcategoryKey]);\n-- CREATE STATISTICS [stat_cso_DimProduct_ProductURL] ON [cso].[DimProduct]([ProductURL]);\n-- CREATE STATISTICS [stat_cso_DimProduct_Size] ON [cso].[DimProduct]([Size]);\n-- CREATE STATISTICS [stat_cso_DimProduct_SizeRange] ON [cso].[DimProduct]([SizeRange]);\n-- CREATE STATISTICS [stat_cso_DimProduct_SizeUnitMeasureID] ON [cso].[DimProduct]([SizeUnitMeasureID]);\n-- CREATE STATISTICS [stat_cso_DimProduct_Status] ON [cso].[DimProduct]([Status]);\n-- CREATE STATISTICS [stat_cso_DimProduct_StockTypeID] ON [cso].[DimProduct]([StockTypeID]);\n-- CREATE STATISTICS [stat_cso_DimProduct_StockTypeName] ON [cso].[DimProduct]([StockTypeName]);\n-- CREATE STATISTICS [stat_cso_DimProduct_StopSaleDate] ON [cso].[DimProduct]([StopSaleDate]);\n-- CREATE STATISTICS [stat_cso_DimProduct_StyleID] ON [cso].[DimProduct]([StyleID]);\n-- CREATE STATISTICS [stat_cso_DimProduct_StyleName] ON [cso].[DimProduct]([StyleName]);\n-- CREATE STATISTICS [stat_cso_DimProduct_UnitCost] ON [cso].[DimProduct]([UnitCost]);\n-- CREATE STATISTICS [stat_cso_DimProduct_UnitOfMeasureID] ON [cso].[DimProduct]([UnitOfMeasureID]);\n-- CREATE STATISTICS [stat_cso_DimProduct_UnitOfMeasureName] ON [cso].[DimProduct]([UnitOfMeasureName]);\n-- CREATE STATISTICS [stat_cso_DimProduct_UnitPrice] ON [cso].[DimProduct]([UnitPrice]);\n-- CREATE STATISTICS [stat_cso_DimProduct_UpdateDate] ON [cso].[DimProduct]([UpdateDate]);\n-- CREATE STATISTICS [stat_cso_DimProduct_Weight] ON [cso].[DimProduct]([Weight]);\n-- CREATE STATISTICS [stat_cso_DimProduct_WeightUnitMeasureID] ON [cso].[DimProduct]([WeightUnitMeasureID]);\n-- CREATE STATISTICS [stat_cso_FactOnlineSales_CurrencyKey] ON [cso].[FactOnlineSales]([CurrencyKey]);\n-- CREATE STATISTICS [stat_cso_FactOnlineSales_CustomerKey] ON [cso].[FactOnlineSales]([CustomerKey]);\n-- CREATE STATISTICS [stat_cso_FactOnlineSales_DateKey] ON [cso].[FactOnlineSales]([DateKey]);\n-- CREATE STATISTICS [stat_cso_FactOnlineSales_OnlineSalesKey] ON [cso].[FactOnlineSales]([OnlineSalesKey]);\n-- CREATE STATISTICS [stat_cso_FactOnlineSales_ProductKey] ON [cso].[FactOnlineSales]([ProductKey]);\n-- CREATE STATISTICS [stat_cso_FactOnlineSales_PromotionKey] ON [cso].[FactOnlineSales]([PromotionKey]);\n-- CREATE STATISTICS [stat_cso_FactOnlineSales_StoreKey] ON [cso].[FactOnlineSales]([StoreKey]);\n\n-- SELECT  SUM(f.[SalesAmount]) AS [sales_by_brand_amount]\n-- ,       p.[BrandName]\n-- FROM    [cso].[FactOnlineSales] AS f\n-- JOIN    [cso].[DimProduct]      AS p ON f.[ProductKey] = p.[ProductKey]\n-- GROUP BY p.[BrandName]",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "devDedicatedSQLpool",
				"poolName": "devDedicatedSQLpool"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}